;;; The following lines added by ql:add-to-init-file:
#-quicklisp
(let ((quicklisp-init (merge-pathnames "quicklisp/setup.lisp"
                                       (user-homedir-pathname))))
  (when (probe-file quicklisp-init)
    (load quicklisp-init)))


(ql:quickload '(:quickproject :osicat :inferior-shell))

;;; Quickproject setup
(setf quickproject:*author* "Andreas Ruscheinski <andreas.ruscheinski@gmail.com>")
(setf quickproject:*template-directory*
      (truename "~/dot-files/quickproject-template"))

(setf quickproject:*after-make-project-hooks*
      (list
       (lambda (pathname &rest args)
         (declare (ignore args))
         (nix:chdir (fad:pathname-as-directory pathname))
         (inferior-shell:run (list "git" "init" "."))
         (inferior-shell:run  (list "git" "add" "."))
         (inferior-shell:run (list "git" "commit" "-m" "Initial commit")))))

(pushnew (truename "~/Code/Common-Lisp") ql:*local-project-directories*)
(ql:register-local-projects)

(defun disasm-method (name specializers)
  "E.g. (disasm-method 'package:generic-fun '(class t))"
  (let* ((method (find-method name nil specializers))
         (function (sb-mop:method-function method))
         (fast-function (sb-pcl::%method-function-fast-function function)))
    (disassemble fast-function)))